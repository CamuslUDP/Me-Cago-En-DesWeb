<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RappiBet – Login</title>
  <link rel="stylesheet" href="../css/styles.css" />
</head>
<body>
  <header class="top-bar">
    <div class="logoo">
      <img src="../fotos/logo.png" alt="RappiBet" class="logo" />
    </div>
    <nav aria-label="Navegación principal">
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="perfil.html">Perfil</a></li>
        <li><a href="ruleta.html">Ruleta</a></li>
        <li><a href="transacciones.html">Transacciones</a></li>
        <li><a href="desarrolladores.html">Sobre Nosotros</a></li>
        <li><a href="historia.html">Reglas y Condiciones</a></li>
      </ul>
    </nav>
  </header>

  <main class="auth">
    <section class="login-card">
      <img src="../fotos/logo.png" alt="RappiBet" class="login-logo">
      <p class="login-sub">ACCOUNT</p>

      <h1 class="login-title">INICIAR SESIÓN</h1>

      <form class="login-form" action="#" method="post" autocomplete="on">
        <label class="field-label" for="email">
          Correo Electrónico <span class="req">*</span>
        </label>
      <div class="input-pill">
        <input type="email" id="email" name="email" placeholder="Correo Electrónico" required>
      </div>

      <label class="field-label" for="password">
        Contraseña <span class="req">*</span>
      </label>
      <div class="input-pill">
        <input type="password" id="password" name="password" placeholder="Contraseña" required>
      </div>

      <button type="button" id="btn-login-submit" class="btn btn-dark">INICIAR SESIÓN</button>

      <div class="login-alt">
        <p>¿No tienes una cuenta RappiBet?</p>
        <a href="registro.html" class="login-link">Crear una cuenta</a>
      </div>
    </form>
    </section>
  </main>
  <script src="../js/commons.js"></script>
  <script>
    document.getElementById("btn-login-submit").addEventListener("click", async () => {
        const emailInput = document.getElementById("email").value; // En el HTML el ID es email, pero el label dice email
        // OJO: tu backend login espera "username", pero el input type email. 
        // Vamos a asumir que el usuario puede ingresar username en ese campo o modificamos el backend.
        // El backend actual busca por { username }. Modifiquemos el input para ser coherentes.
        
        const password = document.getElementById("password").value;
        
        // Asumiendo que el usuario ingresa su USERNAME en el campo (aunque diga email en el label por diseño previo)
        // O ajusta el HTML para que diga "Usuario".
        
        try {
            const res = await fetch("/api/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username: emailInput, password }) 
            });
            const data = await res.json();
            
            if (res.ok) {
                window.location.href = "perfil.html";
            } else {
                alert("Error: " + data.error);
            }
        } catch (e) {
            alert("Error de conexión");
        }
    });
  </script>
</body>
</html>